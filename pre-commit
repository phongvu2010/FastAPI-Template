# #!/usr/bin/env python
# import io
# import subprocess
# import sys

# 1. KHáº®C PHá»¤C Lá»–I ENCODING TRÃŠN WINDOWS
# Ã‰p xung Ä‘áº§u ra sá»­ dá»¥ng UTF-8 Ä‘á»ƒ hiá»ƒn thá»‹ Ä‘Æ°á»£c Emoji (âœ…, âŒ)
# sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
# sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')


# def get_current_branch():
#     try:
#         return subprocess.check_output(
#             ["git", "symbolic-ref", "--short", "HEAD"],
#             stderr=subprocess.DEVNULL,
#         ).decode("utf-8").strip()
#     except subprocess.CalledProcessError:
#         return ""


# def get_staged_files():
#     return subprocess.check_output(
#         ["git", "diff", "--cached", "--name-only"]
#     ).decode("utf-8").splitlines()


# 2. Cáº¤U HÃŒNH VÃ™NG CHO PHÃ‰P (ALLOW-LIST)
# ALLOWED_ZONES = {
#     "main": [""], # NhÃ¡nh main Ä‘Æ°á»£c phÃ©p sá»­a má»i file
#     "core/base-platform": [
#         "alembic/",
#         "app/core/",
#         "app/db/",
#         "app/static/",
#         "app/templates/",
#         "app/__init__.py",
#         "app/main.py",
#         "alembic.ini",
#         "docker-compose.yml",
#         "Dockerfile",
#         "prestart.sh",
#         "requirements.txt",
#     ],
#     "feature/users-module": [
#         "app/modules/users/",
#         "app/initial_data.py",
#     ],
#     "feature/documents-module": [
#         "app/modules/documents/",
#     ],
# }


# def is_allowed(file_path, allowed_paths):
#     for allowed in allowed_paths:
#         # Náº¿u rule lÃ  "" (chuá»—i rá»—ng) thÃ¬ cho phÃ©p táº¥t cáº£
#         if allowed == "" or file_path.startswith(allowed):
#             return True
#     return False

# def main():
#     branch = get_current_branch()
#     files_changed = get_staged_files()

#     # Náº¿u khÃ´ng cÃ³ file nÃ o Ä‘ang staged, cho phÃ©p commit (thÆ°á»ng lÃ  commit --amend hoáº·c empty)
#     if not files_changed:
#         sys.exit(0)

#     # TÃ¬m quy táº¯c Ã¡p dá»¥ng cho nhÃ¡nh hiá»‡n táº¡i
#     matched_branch = None
#     for rule_branch in ALLOWED_ZONES:
#         if branch == rule_branch or branch.startswith(rule_branch):
#             matched_branch = rule_branch
#             break

#     # Náº¿u nhÃ¡nh khÃ´ng náº±m trong danh sÃ¡ch cáº¥u hÃ¬nh -> Cháº·n commit
#     if not matched_branch:
#         print(f"âŒ Lá»–I: NhÃ¡nh '{branch}' khÃ´ng cÃ³ quyá»n commit vÃ o báº¥t ká»³ file nÃ o.")
#         sys.exit(1)

#     allowed_paths = ALLOWED_ZONES[matched_branch]
#     violations = [f for f in files_changed if not is_allowed(f, allowed_paths)]

#     if violations:
#         print(f"\nğŸ”’ COMMIT Bá»Š CHáº¶N TRÃŠN NHÃNH: {branch}")
#         print("Báº¡n Ä‘ang cá»‘ gáº¯ng commit cÃ¡c file ngoÃ i pháº¡m vi cho phÃ©p:")
#         for v in violations:
#             print(f"  âŒ {v}")

#         print("\nâœ… CÃ¡c Ä‘Æ°á»ng dáº«n Ä‘Æ°á»£c phÃ©p cho nhÃ¡nh nÃ y:")
#         for p in allowed_paths:
#             print(f"  - {p or '(Táº¤T Cáº¢)'}")

#         print("\nğŸ‘‰ Vui lÃ²ng unstage hoáº·c revert cÃ¡c file khÃ´ng há»£p lá»‡.")
#         sys.exit(1)

#     print(f"âœ… Há»£p lá»‡! Cho phÃ©p commit trÃªn nhÃ¡nh '{branch}'")
#     sys.exit(0)


# if __name__ == "__main__":
#     main()
